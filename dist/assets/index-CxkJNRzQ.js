(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();const P=["キッチン","洗面・トイレ"],C=new Date().toISOString(),i=(t,e,n=0,s=1)=>({id:`preset-${e}-${t}`,name:t,category:e,qty:n,threshold:s,lastRefillAt:"",nextRefillAt:"",createdAt:C,updatedAt:C,deleted:!1,version:1}),D=[i("キッチンペーパー","キッチン",1,1),i("スポンジ","キッチン",0,1),i("トイレットペーパー","キッチン",0,1),i("ラップ","キッチン",0,1),i("食器洗剤","キッチン",0,1),i("シャンプー","洗面・トイレ",0,1),i("トイレ用洗剤","洗面・トイレ",0,1),i("ボディソープ","洗面・トイレ",0,1),i("歯磨き粉","洗面・トイレ",0,1)],S="stocklite/items",w=()=>{try{return JSON.parse(localStorage.getItem(S)||"[]")}catch{return[]}},b=t=>localStorage.setItem(S,JSON.stringify(t)),M=()=>{w().length===0&&b(D)},E=()=>w(),v=t=>{const e=w(),n=e.findIndex(s=>s.id===t.id);return n>=0?e[n]=t:e.push(t),b(e),t},k=t=>{const e=w(),n=e.findIndex(s=>s.id===t);n>=0&&(e[n].deleted=!0,e[n].updatedAt=new Date().toISOString(),b(e))},f=()=>new Date().toISOString();async function T(){}const y=(t,e=document)=>e.querySelector(t);function o(t,e={},...n){const s=document.createElement(t);Object.assign(s,e);for(const a of n)a!=null&&s.append(a);return s}function _(){return typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():"id-"+Math.random().toString(36).slice(2)+"-"+Date.now()}function A(t,e){return t.name.localeCompare(e.name,"ja")}function L(t){const e=new Set(P);for(const n of t)e.add(n.category);return Array.from(e)}function U(){return o("div",{className:"headerbar"},o("div",{className:"title",textContent:"StockLite"}),o("div",{className:"header-actions"},o("button",{className:"btn",id:"btn-to-edit",textContent:"編集"})))}function $(t){const e=t.qty<=t.threshold,n=e?o("span",{className:"tag danger",textContent:"要補充"}):null,s=o("div",{className:"item-name"+(e?"":" no-tag"),textContent:t.name}),a=o("span",{innerHTML:"個数：<b>"+t.qty+"</b>"}),c=o("button",{className:"btn",textContent:"−"}),r=o("button",{className:"btn",textContent:"＋"});c.addEventListener("click",async()=>{const p=Math.max(0,t.qty-1);if(p===t.qty)return;const g={...t,qty:p,updatedAt:f()};await v(g),await x()}),r.addEventListener("click",async()=>{const p=t.qty+1,g={...t,qty:p,updatedAt:f()};await v(g),await x()});const l=o("div",{className:"row1"},n,s),u=o("div",{className:"row2"},o("div",{className:"qty"},a),o("div",{className:"actions"},c,r)),m=t.nextRefillAt?t.nextRefillAt.slice(5,10).replace("-","/"):"—",R=o("div",{className:"row3",textContent:`次回補充：${m}`});return o("div",{className:"card"},l,u,R)}async function x(){const t=y("#app");t.textContent="",t.append(U());const e=(await Promise.resolve(E())).filter(s=>!s.deleted),n=L(e);for(const s of n){const a=e.filter(c=>c.category===s).sort(A);if(a.length){t.append(o("h2",{className:"cat",textContent:s}));for(const c of a)t.append($(c))}}y("#btn-to-edit")?.addEventListener("click",()=>{location.hash="#/edit"})}function j(){return o("div",{className:"headerbar"},o("div",{className:"title",textContent:"編集"}),o("div",{className:"header-actions"},o("button",{className:"btn",id:"btn-done",textContent:"完了"})))}function h(t,e=0){const n=o("input",{type:"number",value:String(t)});return n.min=String(e),n.inputMode="numeric",n}function q(t=""){return o("input",{type:"text",value:t})}function O(t,e){const n=o("select",{className:"ed-cat"});for(const a of t)n.append(o("option",{value:a,textContent:a,selected:a===e}));n.append(o("option",{value:"__new",textContent:"＋新規カテゴリ"}));const s=()=>{n.value=t.includes(e)?e:t[0]||""};return n.addEventListener("change",()=>{if(n.value!=="__new")return;const a=prompt("カテゴリ名");a?(t.push(a),n.insertBefore(o("option",{value:a,textContent:a}),n.lastElementChild),n.value=a):s()}),n}function d(t,e,n,s){return o("div",{className:`field ${n}`},o("div",{className:"field-label",textContent:t}),e,s?o("div",{className:"field-note",textContent:s}):null)}function H(t,e){const n=q(t.name),s=O(e,t.category),a=h(t.qty,0),c=h(t.threshold,0),r=o("button",{className:"btn save",textContent:"保存"}),l=o("button",{className:"btn danger del",textContent:"削除"}),u=o("div",{className:"edit-row"},d("名前",n,"ed-name"),d("カテゴリ",s,"ed-cat"),d("個数",a,"ed-qty"),d("閾値",c,"ed-th","この数以下で要補充"),o("div",{className:"save"},r),o("div",{className:"del"},l));return r.addEventListener("click",async()=>{const m={...t,name:n.value.trim(),category:s.value,qty:parseInt(a.value||"0",10),threshold:parseInt(c.value||"0",10),updatedAt:f()};await v(m),await N()}),l.addEventListener("click",async()=>{await k(t.id),await N()}),u}function B(t){const e=q(""),n=O(t,t[0]||""),s=h(0,0),a=h(1,0),c=o("button",{className:"btn primary",textContent:"追加"}),r=o("button",{className:"btn ghost",textContent:"クリア"}),l=o("div",{className:"edit-row add"},d("（新規）名前",e,"ed-name"),d("カテゴリ",n,"ed-cat"),d("個数",s,"ed-qty"),d("閾値",a,"ed-th","この数以下で要補充"),o("div",{className:"save"},c),o("div",{className:"del"},r));return c.addEventListener("click",async()=>{const u=e.value.trim();if(!u){e.focus();return}const m={id:_(),name:u,category:n.value,qty:parseInt(s.value||"0",10),threshold:parseInt(a.value||"0",10),lastRefillAt:"",nextRefillAt:"",createdAt:f(),updatedAt:f(),deleted:!1,version:1};await v(m),e.value="",s.value="0",a.value="0",await N()}),r.addEventListener("click",()=>{e.value="",s.value="0",a.value="0"}),l}async function N(){const t=y("#app");t.textContent="";const e=(await Promise.resolve(E())).filter(s=>!s.deleted),n=L(e);e.sort((s,a)=>s.category===a.category?A(s,a):n.indexOf(s.category)-n.indexOf(a.category)),t.append(j(),o("div",{className:"edit-panel"},o("h3",{className:"section-title",textContent:"新規追加"}),B(n),e.length?o("h3",{className:"section-title",textContent:"既存アイテム"}):null,e.length?o("div",{className:"edit-list"},...e.map(s=>H(s,n))):null)),y("#btn-done")?.addEventListener("click",()=>{location.hash=""})}async function I(){location.hash==="#/edit"?await N():await x()}async function F(){await T(),M(),window.addEventListener("hashchange",I),await I()}F();
